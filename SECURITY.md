# セキュリティに関する重要事項

## 環境変数の設定

本アプリケーションは以下の環境変数が必要です：

1. `.env.local.example`を`.env.local`にコピー
2. 各環境変数に適切な値を設定

```bash
cp .env.local.example .env.local
```

## APIキーの管理

- **絶対にAPIキーをソースコードにハードコードしないでください**
- APIキーは環境変数として管理してください
- Gitには`.env.local`をコミットしないでください（.gitignoreに含まれています）

## データの完全性

現在の実装では、以下のデータがローカルストレージに保存されており、ユーザーによる改ざんが可能です：

- `collectedStamps`: 収集したスタンプのリスト
- `isCompleted`: 完了状態
- `isCouponUsed`: クーポン使用状態

### 推奨される対策

1. **サーバーサイド検証**: 
   - クーポン使用時にサーバー側で検証を実施
   - スタンプ収集状態をサーバー側でも管理

2. **データの暗号化**:
   - 重要なデータを暗号化して保存
   - Web Crypto APIを使用した実装例：
   ```javascript
   // 暗号化の例（実装が必要）
   const encryptData = async (data) => {
     // Web Crypto APIを使用した暗号化
   };
   ```

3. **HMAC署名**:
   - データの改ざんを検出するための署名を付与
   - サーバー側の秘密鍵で署名を生成

## セッション管理

- 匿名認証のセッションは定期的に更新されますが、長時間の使用では期限切れの可能性があります
- セッション更新の自動化を検討してください

## プライバシー

- マイクの使用許可を求めます
- 位置情報は現在使用していませんが、コードに残っています
- ユーザーデータは最小限に留めています

## 既知の脆弱性と対策

### 1. クライアントサイドの状態管理
**問題**: すべての重要な状態がクライアントサイドで管理されている
**対策**: サーバーサイドでの状態管理と検証を実装

### 2. テストモード
**問題**: テストモードが有効な場合、ゲームの整合性が崩れる
**対策**: 本番環境では必ず`NEXT_PUBLIC_TEST_MODE=false`を設定

### 3. エラーログの蓄積
**問題**: エラーログがローカルストレージに無制限に蓄積される可能性
**対策**: 定期的なクリーンアップまたは最大保存期間の設定

## セキュリティチェックリスト

デプロイ前に以下を確認してください：

- [ ] 環境変数が正しく設定されている
- [ ] APIキーがハードコードされていない
- [ ] テストモードが無効になっている
- [ ] 本番用のSupabase URLとキーが設定されている
- [ ] HTTPS経由でのみアクセス可能になっている
- [ ] Content Security Policy (CSP)が適切に設定されている

## 報告

セキュリティの脆弱性を発見した場合は、公開せずに以下までご連絡ください：
[セキュリティ連絡先メールアドレス]